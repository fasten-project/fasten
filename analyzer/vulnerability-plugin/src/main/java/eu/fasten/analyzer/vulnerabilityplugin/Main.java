package eu.fasten.analyzer.vulnerabilityplugin;

import eu.fasten.server.kafka.FastenKafkaConnection;
import eu.fasten.server.kafka.FastenKafkaProducer;
import picocli.CommandLine;

import java.util.List;
import java.util.Properties;

/**
 * Makes vulnerability-plugin module runnable from command line.
 */
@CommandLine.Command(name = "Vulnerability")
public class Main implements Runnable {

    @CommandLine.Option(names = {"-k", "--kafka_server"},
            paramLabel = "server.name:port",
            description = "Kafka server to connect to. Use multiple times for clusters.",
            defaultValue = "localhost:9092")
    List<String> kafkaServers;

    public static void main(String[] args) {
        final int exitCode = new CommandLine(new Main()).execute(args);
        System.exit(exitCode);
    }

    @Override
    public void run() {
        var vulnProducer = new VulnerabilityPlugin.VulnerabilityProducer();

        // Setting Properties
        Properties properties = FastenKafkaConnection.producerProperties(kafkaServers,
                this.getClass().getCanonicalName());

        var temp = new FastenKafkaProducer(properties, vulnProducer);
        temp.run();
        vulnProducer.start();
    }
}
